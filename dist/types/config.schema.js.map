{"version":3,"file":"config.schema.js","sources":["../../src/types/config.schema.ts"],"sourcesContent":["import z from 'zod'\nimport * as core from '@actions/core'\nimport { context } from '@actions/github'\nimport { stringToRegex } from 'src/common/string-to-regex'\n\nexport const configSchema = z\n  .object({\n    /**\n     * The template to use for each merged pull request.\n     */\n    'change-template': z\n      .string()\n      .optional()\n      .default('* $TITLE (#$NUMBER) @$AUTHOR'),\n    /**\n     * Characters to escape in `$TITLE` when inserting into `change-template` so that they are not interpreted as Markdown format characters.\n     */\n    'change-title-escapes': z.string().optional(),\n    /**\n     * The template to use for when thereâ€™s no changes.\n     */\n    'no-changes-template': z.string().optional().default('* No changes'),\n    /**\n     * The template to use when calculating the next version number for the release. Useful for projects that don't use semantic versioning.\n     */\n    'version-template': z\n      .string()\n      .optional()\n      .default('$MAJOR.$MINOR.$PATCH$PRERELEASE'),\n    /**\n     * The template for the name of the draft release.\n     */\n    'name-template': z.string().optional(),\n    /**\n     * A known prefix used to filter release tags. For matching tags, this prefix is stripped before attempting to parse the version.\n     */\n    'tag-prefix': z.string().optional(),\n    /**\n     * The template for the tag of the draft release.\n     */\n    'tag-template': z.string().optional(),\n    /**\n     * Exclude pull requests using labels.\n     */\n    'exclude-labels': z.array(z.string()).optional().default([]),\n    /**\n     * Include only the specified pull requests using labels.\n     */\n    'include-labels': z.array(z.string()).optional().default([]),\n    /**\n     * Restrict pull requests included in the release notes to only the pull requests that modified any of the paths in this array. Supports files and directories.\n     */\n    'include-paths': z.array(z.string()).optional().default([]),\n    /**\n     * Exclude specific usernames from the generated `$CONTRIBUTORS` variable.\n     */\n    'exclude-contributors': z.array(z.string()).optional().default([]),\n    /**\n     * The template to use for `$CONTRIBUTORS` when there's no contributors to list.\n     */\n    'no-contributors-template': z\n      .string()\n      .optional()\n      .default('No contributors'),\n    /**\n     * Sort changelog by merged_at or title.\n     */\n    'sort-by': z.enum(['merged_at', 'title']).optional().default('merged_at'),\n    /**\n     * Sort changelog in ascending or descending order.\n     */\n    'sort-direction': z\n      .enum(['ascending', 'descending'])\n      .optional()\n      .default('descending'),\n    /**\n     * Mark the draft release as pre-release.\n     */\n    prerelease: z.boolean().optional().default(false),\n    'prerelease-identifier': z.string().optional(),\n    /**\n     * Mark the release as latest. Only works for published releases.\n     */\n    latest: z.stringbool().optional().default(true),\n    /**\n     * Filter previous releases to consider only those with the target matching `commitish`.\n     */\n    'filter-by-commitish': z.boolean().optional().default(false),\n    /**\n     * When drafting your first release, limit the amount of scanned commits. Expects an ISO 8601 date. Default: undefined (scan all commits).\n     * @see https://zod.dev/api?id=iso-dates#iso-datetimes\n     */\n    'initial-commits-since': z.iso.datetime().optional(),\n    /**\n     * Include pre releases as \"full\" releases when drafting release notes.\n     */\n    'include-pre-releases': z.boolean().optional().default(false),\n    /**\n     * The release target, i.e. branch or commit it should point to. Default: the ref that release-drafter runs for, e.g. `refs/heads/master` if configured to run on pushes to `master`.\n     */\n    commitish: z\n      .string()\n      .optional()\n      .default(context.ref || context.payload.ref),\n    'pull-request-limit': z.number().int().positive().optional().default(5),\n    /**\n     * Size of the pagination window when walking the repo. Can avoid erratic 502s from Github. Default: `15`\n     */\n    'history-limit': z.number().int().positive().optional().default(15),\n    /**\n     * Search and replace content in the generated changelog body.\n     */\n    replacers: z\n      .array(\n        z.object({\n          search: z.string().min(1),\n          replace: z.string().min(0)\n        })\n      )\n      .optional()\n      .default([])\n      .transform((replacers) =>\n        // convert 'search' to regex and remove invalid entries\n        replacers\n          .map((r) => {\n            try {\n              return { ...r, search: stringToRegex(r.search) }\n            } catch {\n              core.warning(`Bad replacer regex: '${r.search}'`)\n              return false\n            }\n          })\n          .filter((r) => !!r)\n      ),\n    /**\n     * You can add automatically a label into a pull request.\n     * Available matchers are `files` (glob), `branch` (regex), `title` (regex) and `body` (regex).\n     * Matchers are evaluated independently; the label will be set if at least one of the matchers meets the criteria.\n     */\n    autolabeler: z\n      .array(\n        z.object({\n          label: z.string().min(1),\n          files: z.array(z.string().min(1)).optional().default([]),\n          branch: z.array(z.string().min(1)).optional().default([]),\n          title: z.array(z.string().min(1)).optional().default([]),\n          body: z.array(z.string().min(1)).optional().default([])\n        })\n      )\n      .optional()\n      .default([])\n      .transform((autolabels) =>\n        // convert 'branch', 'title' and 'body' to regex and remove invalid entries\n        autolabels\n          .map((autolabel) => {\n            try {\n              return {\n                ...autolabel,\n                branch: autolabel.branch.map((reg) => {\n                  return stringToRegex(reg)\n                }),\n                title: autolabel.title.map((reg) => {\n                  return stringToRegex(reg)\n                }),\n                body: autolabel.body.map((reg) => {\n                  return stringToRegex(reg)\n                })\n              }\n            } catch {\n              core.warning(\n                `Bad autolabeler regex: '${autolabel.branch}', '${autolabel.title}' or '${autolabel.body}'`\n              )\n              return false\n            }\n          })\n          .filter((a) => !!a)\n      ),\n    /**\n     * Categorize pull requests using labels.\n     */\n    categories: z\n      .array(\n        z.object({\n          title: z.string().min(1),\n          'collapse-after': z.number().int().min(0).optional().default(0),\n          labels: z.array(z.string().min(1)).optional().default([])\n        })\n      )\n      .optional()\n      .default([]),\n    /**\n     * Adjust the `$RESOLVED_VERSION` variable using labels.\n     */\n    'version-resolver': z\n      .object({\n        major: z.object({\n          labels: z.array(z.string().min(1)).optional().default([])\n        }),\n        minor: z.object({\n          labels: z.array(z.string().min(1)).optional().default([])\n        }),\n        patch: z.object({\n          labels: z.array(z.string().min(1)).optional().default([])\n        }),\n        default: z.enum(['major', 'minor', 'patch']).optional().default('patch')\n      })\n      .optional()\n      .default({\n        major: { labels: [] },\n        minor: { labels: [] },\n        patch: { labels: [] },\n        default: 'patch'\n      }),\n    /**\n     * The template to use for each category.\n     */\n    'category-template': z.string().optional().default('## $TITLE'),\n    /**\n     * Will be prepended to `template`.\n     */\n    header: z.string().optional(),\n    /**\n     * The template for the body of the draft release.\n     */\n    template: z.string().min(1),\n    /**\n     * Will be appended to `template`.\n     */\n    footer: z.string().optional(),\n    _extends: z.string().optional()\n  })\n  .superRefine((config, ctx) => {\n    // Validate that only one uncategorized category exists\n    const uncategorizedCategories = config.categories.filter(\n      (category) => category.labels.length === 0\n    )\n    if (uncategorizedCategories.length > 1) {\n      ctx.addIssue({\n        code: 'custom',\n        message:\n          'Multiple categories detected with no labels. Only one category with no labels is supported for uncategorized pull requests.'\n      })\n    }\n\n    if (config.latest && config.prerelease) {\n      ctx.addIssue({\n        code: 'custom',\n        message: \"'prerelease' and 'latest' cannot both be truthy.\"\n      })\n    }\n  })\n\nexport type Config = z.output<typeof configSchema>\n"],"names":["context","core.warning"],"mappings":"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"}