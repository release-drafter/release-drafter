{"version":3,"file":"find-commits-with-path-change.js","sources":["../../../../../src/actions/drafter/lib/find-pull-requests/find-commits-with-path-change.ts"],"sourcesContent":["import { getOctokit, paginateGraphql } from 'src/common'\nimport { getGqlQuery } from './get-query'\nimport { Config } from 'src/types'\nimport {\n  FindCommitsWithPathChangesQueryQuery,\n  FindCommitsWithPathChangesQueryQueryVariables\n} from './graphql/find-commits-with-path-changes.graphql.generated'\n\nexport const findCommitsWithPathChange = async (\n  paths: Config['include-paths'],\n  params: Omit<FindCommitsWithPathChangesQueryQueryVariables, 'path'>\n) => {\n  const octokit = getOctokit()\n  const commitIdsMatchingPaths: Record<string, Set<string>> = {}\n  let hasFoundCommits = false\n\n  for (const path of paths) {\n    const data = await paginateGraphql<FindCommitsWithPathChangesQueryQuery>(\n      octokit.graphql,\n      getGqlQuery('find-commits-with-path-changes'),\n      { ...params, path },\n      ['repository', 'object', 'history']\n    )\n\n    if (data.repository?.object?.__typename !== 'Commit') {\n      throw new Error('Query returned an unexpected result')\n    }\n\n    const commits = (data.repository?.object?.history.nodes || []).filter(\n      (c) => !!c\n    )\n\n    commitIdsMatchingPaths[path] = commitIdsMatchingPaths[path] || new Set([])\n\n    for (const { id } of commits) {\n      hasFoundCommits = true\n      commitIdsMatchingPaths[path].add(id)\n    }\n  }\n\n  return { commitIdsMatchingPaths, hasFoundCommits }\n}\n"],"names":[],"mappings":";;;;;;;;;;;AAQO,MAAM,4BAA4B,OACvC,OACA,WACG;AACH,QAAM,UAAU,WAAA;AAChB,QAAM,yBAAsD,CAAA;AAC5D,MAAI,kBAAkB;AAEtB,aAAW,QAAQ,OAAO;AACxB,UAAM,OAAO,MAAM;AAAA,MACjB,QAAQ;AAAA,MACR,YAAY,gCAAgC;AAAA,MAC5C,EAAE,GAAG,QAAQ,KAAA;AAAA,MACb,CAAC,cAAc,UAAU,SAAS;AAAA,IAAA;AAGpC,QAAI,KAAK,YAAY,QAAQ,eAAe,UAAU;AACpD,YAAM,IAAI,MAAM,qCAAqC;AAAA,IACvD;AAEA,UAAM,WAAW,KAAK,YAAY,QAAQ,QAAQ,SAAS,CAAA,GAAI;AAAA,MAC7D,CAAC,MAAM,CAAC,CAAC;AAAA,IAAA;AAGX,2BAAuB,IAAI,IAAI,uBAAuB,IAAI,KAAK,oBAAI,IAAI,EAAE;AAEzE,eAAW,EAAE,GAAA,KAAQ,SAAS;AAC5B,wBAAkB;AAClB,6BAAuB,IAAI,EAAE,IAAI,EAAE;AAAA,IACrC;AAAA,EACF;AAEA,SAAO,EAAE,wBAAwB,gBAAA;AACnC;"}