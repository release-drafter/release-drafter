{"version":3,"file":"find-commits-with-pr.js","sources":["../../../../../src/actions/drafter/lib/find-pull-requests/find-commits-with-pr.ts"],"sourcesContent":["import { getOctokit, paginateGraphql } from 'src/common'\nimport { getGqlQuery } from './get-query'\nimport {\n  FindCommitsWithAssociatedPullRequestsQuery,\n  FindCommitsWithAssociatedPullRequestsQueryVariables\n} from './graphql/find-commits-with-pr.graphql.generated'\n\nexport const findCommitsWithPr = async (\n  params: FindCommitsWithAssociatedPullRequestsQueryVariables\n) => {\n  const octokit = getOctokit()\n\n  const data =\n    await paginateGraphql<FindCommitsWithAssociatedPullRequestsQuery>(\n      octokit.graphql,\n      getGqlQuery('find-commits-with-pr'),\n      params,\n      ['repository', 'object', 'history']\n    )\n\n  if (data.repository?.object?.__typename !== 'Commit') {\n    throw new Error('Query returned an unexpected result')\n  }\n\n  /**\n   * Extract commit nodes from the paginated response\n   */\n  const commits = (data.repository.object.history.nodes || []).filter(\n    (commit): commit is NonNullable<typeof commit> => commit != null\n  )\n\n  if (params.since) {\n    // GraphQL call is inclusive of commits from the specified dates.  This means the final\n    // commit from the last tag is included, so we remove this here.\n    return commits.filter(\n      (commit) =>\n        !!commit?.committedDate && commit.committedDate != params.since\n    )\n  } else {\n    return commits\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;AAOO,MAAM,oBAAoB,OAC/B,WACG;AACH,QAAM,UAAU,WAAA;AAEhB,QAAM,OACJ,MAAM;AAAA,IACJ,QAAQ;AAAA,IACR,YAAY,sBAAsB;AAAA,IAClC;AAAA,IACA,CAAC,cAAc,UAAU,SAAS;AAAA,EAAA;AAGtC,MAAI,KAAK,YAAY,QAAQ,eAAe,UAAU;AACpD,UAAM,IAAI,MAAM,qCAAqC;AAAA,EACvD;AAKA,QAAM,WAAW,KAAK,WAAW,OAAO,QAAQ,SAAS,CAAA,GAAI;AAAA,IAC3D,CAAC,WAAiD,UAAU;AAAA,EAAA;AAG9D,MAAI,OAAO,OAAO;AAGhB,WAAO,QAAQ;AAAA,MACb,CAAC,WACC,CAAC,CAAC,QAAQ,iBAAiB,OAAO,iBAAiB,OAAO;AAAA,IAAA;AAAA,EAEhE,OAAO;AACL,WAAO;AAAA,EACT;AACF;"}