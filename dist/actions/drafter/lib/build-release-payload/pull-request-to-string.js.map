{"version":3,"file":"pull-request-to-string.js","sources":["../../../../../src/actions/drafter/lib/build-release-payload/pull-request-to-string.ts"],"sourcesContent":["import { Config } from 'src/types'\nimport { findPullRequests } from '../find-pull-requests'\nimport { renderTemplate } from './render-template'\nimport regexEscape from 'escape-string-regexp'\n\ntype Pr = Awaited<ReturnType<typeof findPullRequests>>['pullRequests'][number]\n\nexport const pullRequestToString = (params: {\n  pullRequests: Pr[]\n  config: Pick<Config, 'change-template' | 'change-title-escapes'>\n}) =>\n  params.pullRequests\n    .map((pullRequest) => {\n      let pullAuthor = 'ghost'\n      if (pullRequest.author) {\n        pullAuthor =\n          pullRequest.author.__typename &&\n          pullRequest.author.__typename === 'Bot'\n            ? `[${pullRequest.author.login}[bot]](${pullRequest.author.url})`\n            : pullRequest.author.login\n      }\n\n      return renderTemplate({\n        template: params.config['change-template'],\n        object: {\n          $TITLE: escapeTitle({\n            title: pullRequest.title,\n            escapes: params.config['change-title-escapes']\n          }),\n          $NUMBER: pullRequest.number.toString(),\n          $AUTHOR: pullAuthor,\n          $BODY: pullRequest.body,\n          $URL: pullRequest.url,\n          $BASE_REF_NAME: pullRequest.baseRefName,\n          $HEAD_REF_NAME: pullRequest.headRefName\n        }\n      })\n    })\n    .join('\\n')\n\nconst escapeTitle = (params: {\n  title: Pr['title']\n  escapes: Config['change-title-escapes']\n}) =>\n  // If config['change-title-escapes'] contains backticks, then they will be escaped along with content contained inside backticks\n  // If not, the entire backtick block is matched so that it will become a markdown code block without escaping any of its content\n  params.title.replace(\n    new RegExp(`[${regexEscape(params.escapes || '')}]|\\`.*?\\``, 'g'),\n    (match) => {\n      if (match.length > 1) return match\n      if (match == '@' || match == '#') return `${match}<!---->`\n      return `\\\\${match}`\n    }\n  )\n"],"names":["regexEscape"],"mappings":";;AAOO,MAAM,sBAAsB,CAAC,WAIlC,OAAO,aACJ,IAAI,CAAC,gBAAgB;AACpB,MAAI,aAAa;AACjB,MAAI,YAAY,QAAQ;AACtB,iBACE,YAAY,OAAO,cACnB,YAAY,OAAO,eAAe,QAC9B,IAAI,YAAY,OAAO,KAAK,UAAU,YAAY,OAAO,GAAG,MAC5D,YAAY,OAAO;AAAA,EAC3B;AAEA,SAAO,eAAe;AAAA,IACpB,UAAU,OAAO,OAAO,iBAAiB;AAAA,IACzC,QAAQ;AAAA,MACN,QAAQ,YAAY;AAAA,QAClB,OAAO,YAAY;AAAA,QACnB,SAAS,OAAO,OAAO,sBAAsB;AAAA,MAAA,CAC9C;AAAA,MACD,SAAS,YAAY,OAAO,SAAA;AAAA,MAC5B,SAAS;AAAA,MACT,OAAO,YAAY;AAAA,MACnB,MAAM,YAAY;AAAA,MAClB,gBAAgB,YAAY;AAAA,MAC5B,gBAAgB,YAAY;AAAA,IAAA;AAAA,EAC9B,CACD;AACH,CAAC,EACA,KAAK,IAAI;AAEd,MAAM,cAAc,CAAC;AAAA;AAAA;AAAA,EAMnB,OAAO,MAAM;AAAA,IACX,IAAI,OAAO,IAAIA,mBAAY,OAAO,WAAW,EAAE,CAAC,aAAa,GAAG;AAAA,IAChE,CAAC,UAAU;AACT,UAAI,MAAM,SAAS,EAAG,QAAO;AAC7B,UAAI,SAAS,OAAO,SAAS,IAAK,QAAO,GAAG,KAAK;AACjD,aAAO,KAAK,KAAK;AAAA,IACnB;AAAA,EAAA;AAAA;"}