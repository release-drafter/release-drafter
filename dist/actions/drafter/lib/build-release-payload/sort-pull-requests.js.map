{"version":3,"file":"sort-pull-requests.js","sources":["../../../../../src/actions/drafter/lib/build-release-payload/sort-pull-requests.ts"],"sourcesContent":["import { Config } from 'src/types'\nimport { findPullRequests } from '../find-pull-requests'\nimport z from 'zod'\nimport core from '@actions/core'\n\ntype Pr = Awaited<ReturnType<typeof findPullRequests>>['pullRequests'][number]\ntype TPrMergedAt = Pr['mergedAt']\n\nexport const sortPullRequests = (params: {\n  pullRequests: Pr[]\n  config: Pick<Config, 'sort-by' | 'sort-direction'>\n}) => {\n  const {\n    pullRequests,\n    config: { 'sort-by': sortBy, 'sort-direction': sortDirection }\n  } = params\n\n  const getSortField = sortBy === 'title' ? getTitle : getMergedAt\n\n  const sort =\n    sortDirection === 'ascending' ? dateSortAscending : dateSortDescending\n\n  return structuredClone(pullRequests).sort((a, b) => {\n    try {\n      return sort(getSortField(a), getSortField(b))\n    } catch (error) {\n      core.warning(\n        `Failed to sort pull-requests ${a.number} and ${b.number} by ${sortBy} in ${sortDirection} order. Returning unsorted.`\n      )\n      core.error(error as Error)\n      return 0\n    }\n  })\n}\n\nconst getTitle = (pr: Pr) => pr.title\nconst getMergedAt = (pr: Pr): TPrMergedAt => pr.mergedAt\n\nconst supportedDateSchema = z\n  .date()\n  .or(z.string())\n  .transform((date) => {\n    return typeof date === 'string' ? new Date(date) : date\n  })\n\nconst dateSortAscending = (date1: TPrMergedAt, date2: TPrMergedAt) => {\n  const _date1 = supportedDateSchema.parse(date1)\n  const _date2 = supportedDateSchema.parse(date2)\n  if (_date1 > _date2) return 1\n  if (_date1 < _date2) return -1\n  return 0\n}\n\nconst dateSortDescending = (date1: TPrMergedAt, date2: TPrMergedAt) => {\n  const _date1 = supportedDateSchema.parse(date1)\n  const _date2 = supportedDateSchema.parse(date2)\n  if (_date1 > _date2) return -1\n  if (_date1 < _date2) return 1\n  return 0\n}\n"],"names":[],"mappings":";;AAQO,MAAM,mBAAmB,CAAC,WAG3B;AACJ,QAAM;AAAA,IACJ;AAAA,IACA,QAAQ,EAAE,WAAW,QAAQ,kBAAkB,cAAA;AAAA,EAAc,IAC3D;AAEJ,QAAM,eAAe,WAAW,UAAU,WAAW;AAErD,QAAM,OACJ,kBAAkB,cAAc,oBAAoB;AAEtD,SAAO,gBAAgB,YAAY,EAAE,KAAK,CAAC,GAAG,MAAM;AAClD,QAAI;AACF,aAAO,KAAK,aAAa,CAAC,GAAG,aAAa,CAAC,CAAC;AAAA,IAC9C,SAAS,OAAO;AACd,WAAK;AAAA,QACH,gCAAgC,EAAE,MAAM,QAAQ,EAAE,MAAM,OAAO,MAAM,OAAO,aAAa;AAAA,MAAA;AAE3F,WAAK,MAAM,KAAc;AACzB,aAAO;AAAA,IACT;AAAA,EACF,CAAC;AACH;AAEA,MAAM,WAAW,CAAC,OAAW,GAAG;AAChC,MAAM,cAAc,CAAC,OAAwB,GAAG;AAEhD,MAAM,sBAAsB,EACzB,KAAA,EACA,GAAG,EAAE,QAAQ,EACb,UAAU,CAAC,SAAS;AACnB,SAAO,OAAO,SAAS,WAAW,IAAI,KAAK,IAAI,IAAI;AACrD,CAAC;AAEH,MAAM,oBAAoB,CAAC,OAAoB,UAAuB;AACpE,QAAM,SAAS,oBAAoB,MAAM,KAAK;AAC9C,QAAM,SAAS,oBAAoB,MAAM,KAAK;AAC9C,MAAI,SAAS,OAAQ,QAAO;AAC5B,MAAI,SAAS,OAAQ,QAAO;AAC5B,SAAO;AACT;AAEA,MAAM,qBAAqB,CAAC,OAAoB,UAAuB;AACrE,QAAM,SAAS,oBAAoB,MAAM,KAAK;AAC9C,QAAM,SAAS,oBAAoB,MAAM,KAAK;AAC9C,MAAI,SAAS,OAAQ,QAAO;AAC5B,MAAI,SAAS,OAAQ,QAAO;AAC5B,SAAO;AACT;"}