{"version":3,"file":"generate-changelog.js","sources":["../../../../../src/actions/drafter/lib/build-release-payload/generate-changelog.ts"],"sourcesContent":["import { Config } from 'src/types'\nimport { findPullRequests } from '../find-pull-requests'\nimport { categorizePullRequests } from './categorize-pull-requests'\nimport { pullRequestToString } from './pull-request-to-string'\nimport { renderTemplate } from './render-template'\n\nexport const generateChangeLog = (params: {\n  pullRequests: Awaited<ReturnType<typeof findPullRequests>>['pullRequests']\n  config: Pick<\n    Config,\n    | 'change-title-escapes'\n    | 'no-changes-template'\n    | 'exclude-labels'\n    | 'include-labels'\n    | 'categories'\n    | 'change-template'\n    | 'category-template'\n  >\n}) => {\n  const { pullRequests, config } = params\n\n  if (pullRequests.length === 0) {\n    return config['no-changes-template']\n  }\n\n  const [uncategorizedPullRequests, categorizedPullRequests] =\n    categorizePullRequests({ pullRequests, config })\n\n  const changeLog = []\n\n  if (uncategorizedPullRequests.length > 0) {\n    changeLog.push(\n      pullRequestToString({ pullRequests: uncategorizedPullRequests, config }),\n      '\\n\\n'\n    )\n  }\n\n  for (const [index, category] of categorizedPullRequests.entries()) {\n    if (category.pullRequests.length === 0) {\n      continue\n    }\n\n    // Add the category title to the changelog.\n    changeLog.push(\n      renderTemplate({\n        template: config['category-template'],\n        object: { $TITLE: category.title }\n      }),\n      '\\n\\n'\n    )\n\n    // Define the pull requests into a single string.\n    const pullRequestString = pullRequestToString({\n      pullRequests: category.pullRequests,\n      config\n    })\n\n    // Determine the collapse status.\n    const shouldCollapse =\n      category['collapse-after'] !== 0 &&\n      category.pullRequests.length > category['collapse-after']\n\n    // Add the pull requests to the changelog.\n    if (shouldCollapse) {\n      changeLog.push(\n        '<details>',\n        '\\n',\n        `<summary>${category.pullRequests.length} changes</summary>`,\n        '\\n\\n',\n        pullRequestString,\n        '\\n',\n        '</details>'\n      )\n    } else {\n      changeLog.push(pullRequestString)\n    }\n\n    if (index + 1 !== categorizedPullRequests.length) changeLog.push('\\n\\n')\n  }\n\n  return changeLog.join('').trim()\n}\n"],"names":[],"mappings":";;;AAMO,MAAM,oBAAoB,CAAC,WAY5B;AACJ,QAAM,EAAE,cAAc,OAAA,IAAW;AAEjC,MAAI,aAAa,WAAW,GAAG;AAC7B,WAAO,OAAO,qBAAqB;AAAA,EACrC;AAEA,QAAM,CAAC,2BAA2B,uBAAuB,IACvD,uBAAuB,EAAE,cAAc,QAAQ;AAEjD,QAAM,YAAY,CAAA;AAElB,MAAI,0BAA0B,SAAS,GAAG;AACxC,cAAU;AAAA,MACR,oBAAoB,EAAE,cAAc,2BAA2B,QAAQ;AAAA,MACvE;AAAA,IAAA;AAAA,EAEJ;AAEA,aAAW,CAAC,OAAO,QAAQ,KAAK,wBAAwB,WAAW;AACjE,QAAI,SAAS,aAAa,WAAW,GAAG;AACtC;AAAA,IACF;AAGA,cAAU;AAAA,MACR,eAAe;AAAA,QACb,UAAU,OAAO,mBAAmB;AAAA,QACpC,QAAQ,EAAE,QAAQ,SAAS,MAAA;AAAA,MAAM,CAClC;AAAA,MACD;AAAA,IAAA;AAIF,UAAM,oBAAoB,oBAAoB;AAAA,MAC5C,cAAc,SAAS;AAAA,MACvB;AAAA,IAAA,CACD;AAGD,UAAM,iBACJ,SAAS,gBAAgB,MAAM,KAC/B,SAAS,aAAa,SAAS,SAAS,gBAAgB;AAG1D,QAAI,gBAAgB;AAClB,gBAAU;AAAA,QACR;AAAA,QACA;AAAA,QACA,YAAY,SAAS,aAAa,MAAM;AAAA,QACxC;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MAAA;AAAA,IAEJ,OAAO;AACL,gBAAU,KAAK,iBAAiB;AAAA,IAClC;AAEA,QAAI,QAAQ,MAAM,wBAAwB,OAAQ,WAAU,KAAK,MAAM;AAAA,EACzE;AAEA,SAAO,UAAU,KAAK,EAAE,EAAE,KAAA;AAC5B;"}