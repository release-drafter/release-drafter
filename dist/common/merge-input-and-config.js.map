{"version":3,"file":"merge-input-and-config.js","sources":["../../src/common/merge-input-and-config.ts"],"sourcesContent":["import * as core from '@actions/core'\nimport isBoolean from 'lodash/isBoolean.js'\nimport { Config } from 'src/types'\nimport { ConfigOverridesInput } from 'src/types/action-input.schema'\n\n/**\n * Returns a copy of `config`, updated with values from `input`.\n *\n * Also performs some validation.\n *\n * Input takes precedence, because it's more easy to change at runtime\n */\nexport const mergeInputAndConfig = (params: {\n  config: Config\n  input: ConfigOverridesInput\n}): Config => {\n  const { config: originalConfig, input } = params\n  const config = structuredClone(originalConfig)\n\n  if (input.commitish) {\n    if (config.commitish && config.commitish !== input.commitish) {\n      core.info(\n        `Input's commitish \"${input.commitish}\" overrides config's commitish \"${config.commitish}\"`\n      )\n    }\n    config.commitish = input.commitish\n  }\n\n  if (input.header) {\n    if (config.header && config.header !== input.header) {\n      core.info(\n        `Input's header \"${input.header}\" overrides config's header \"${config.header}\"`\n      )\n    }\n    config.header = input.header\n  }\n\n  if (input.footer) {\n    if (config.footer && config.footer !== input.footer) {\n      core.info(\n        `Input's footer \"${input.footer}\" overrides config's footer \"${config.footer}\"`\n      )\n    }\n    config.footer = input.footer\n  }\n\n  if (input['prerelease-identifier']) {\n    if (\n      config['prerelease-identifier'] &&\n      config['prerelease-identifier'] !== input['prerelease-identifier']\n    ) {\n      core.info(\n        `Input's prerelease-identifier \"${input['prerelease-identifier']}\" overrides config's prerelease-identifier \"${config['prerelease-identifier']}\"`\n      )\n    }\n    config['prerelease-identifier'] = input['prerelease-identifier']\n  }\n\n  if (isBoolean(input.prerelease)) {\n    if (\n      isBoolean(config.prerelease) &&\n      config.prerelease !== input.prerelease\n    ) {\n      core.info(\n        `Input's prerelease \"${input.prerelease}\" overrides config's prerelease \"${config.prerelease}\"`\n      )\n    }\n    config.prerelease = input.prerelease\n  }\n\n  if (isBoolean(input.latest)) {\n    if (isBoolean(config.latest) && config.latest !== input.latest) {\n      core.info(\n        `Input's latest \"${input.latest}\" overrides config's latest \"${config.latest}\"`\n      )\n    }\n    config.latest = input.latest\n  }\n\n  if (config.latest && config.prerelease) {\n    core.warning(\n      \"'prerelease' and 'latest' cannot be both true. Switch 'latest' to false - release will be a pre-release.\"\n    )\n    config.latest = false\n  }\n\n  if (config['prerelease-identifier'] && !config['include-pre-releases']) {\n    core.warning(\n      `You have specified a 'prerelease-identifier' (${config['prerelease-identifier']}), but 'include-pre-releases' is set to false. Switching to true.`\n    )\n    config['include-pre-releases'] = true\n  }\n\n  return config\n}\n"],"names":["core.info","core.warning"],"mappings":";;AAYO,MAAM,sBAAsB,CAAC,WAGtB;AACZ,QAAM,EAAE,QAAQ,gBAAgB,MAAA,IAAU;AAC1C,QAAM,SAAS,gBAAgB,cAAc;AAE7C,MAAI,MAAM,WAAW;AACnB,QAAI,OAAO,aAAa,OAAO,cAAc,MAAM,WAAW;AAC5DA,kBAAAA;AAAAA,QACE,sBAAsB,MAAM,SAAS,mCAAmC,OAAO,SAAS;AAAA,MAAA;AAAA,IAE5F;AACA,WAAO,YAAY,MAAM;AAAA,EAC3B;AAEA,MAAI,MAAM,QAAQ;AAChB,QAAI,OAAO,UAAU,OAAO,WAAW,MAAM,QAAQ;AACnDA,kBAAAA;AAAAA,QACE,mBAAmB,MAAM,MAAM,gCAAgC,OAAO,MAAM;AAAA,MAAA;AAAA,IAEhF;AACA,WAAO,SAAS,MAAM;AAAA,EACxB;AAEA,MAAI,MAAM,QAAQ;AAChB,QAAI,OAAO,UAAU,OAAO,WAAW,MAAM,QAAQ;AACnDA,kBAAAA;AAAAA,QACE,mBAAmB,MAAM,MAAM,gCAAgC,OAAO,MAAM;AAAA,MAAA;AAAA,IAEhF;AACA,WAAO,SAAS,MAAM;AAAA,EACxB;AAEA,MAAI,MAAM,uBAAuB,GAAG;AAClC,QACE,OAAO,uBAAuB,KAC9B,OAAO,uBAAuB,MAAM,MAAM,uBAAuB,GACjE;AACAA,kBAAAA;AAAAA,QACE,kCAAkC,MAAM,uBAAuB,CAAC,+CAA+C,OAAO,uBAAuB,CAAC;AAAA,MAAA;AAAA,IAElJ;AACA,WAAO,uBAAuB,IAAI,MAAM,uBAAuB;AAAA,EACjE;AAEA,MAAI,UAAU,MAAM,UAAU,GAAG;AAC/B,QACE,UAAU,OAAO,UAAU,KAC3B,OAAO,eAAe,MAAM,YAC5B;AACAA,kBAAAA;AAAAA,QACE,uBAAuB,MAAM,UAAU,oCAAoC,OAAO,UAAU;AAAA,MAAA;AAAA,IAEhG;AACA,WAAO,aAAa,MAAM;AAAA,EAC5B;AAEA,MAAI,UAAU,MAAM,MAAM,GAAG;AAC3B,QAAI,UAAU,OAAO,MAAM,KAAK,OAAO,WAAW,MAAM,QAAQ;AAC9DA,kBAAAA;AAAAA,QACE,mBAAmB,MAAM,MAAM,gCAAgC,OAAO,MAAM;AAAA,MAAA;AAAA,IAEhF;AACA,WAAO,SAAS,MAAM;AAAA,EACxB;AAEA,MAAI,OAAO,UAAU,OAAO,YAAY;AACtCC,gBAAAA;AAAAA,MACE;AAAA,IAAA;AAEF,WAAO,SAAS;AAAA,EAClB;AAEA,MAAI,OAAO,uBAAuB,KAAK,CAAC,OAAO,sBAAsB,GAAG;AACtEA,gBAAAA;AAAAA,MACE,iDAAiD,OAAO,uBAAuB,CAAC;AAAA,IAAA;AAElF,WAAO,sBAAsB,IAAI;AAAA,EACnC;AAEA,SAAO;AACT;"}